"use strict";var at=Object.create;var v=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var ut=Object.getPrototypeOf,ct=Object.prototype.hasOwnProperty;var dt=(e,t)=>{for(var r in t)v(e,r,{get:t[r],enumerable:!0})},H=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of pt(t))!ct.call(e,n)&&n!==r&&v(e,n,{get:()=>t[n],enumerable:!(s=lt(t,n))||s.enumerable});return e};var d=(e,t,r)=>(r=e!=null?at(ut(e)):{},H(t||!e||!e.__esModule?v(r,"default",{value:e,enumerable:!0}):r,e)),mt=e=>H(v({},"__esModule",{value:!0}),e);var Pt={};dt(Pt,{analyzer:()=>jt,default:()=>jt});module.exports=mt(Pt);var L=d(require("path")),R=d(require("fs/promises")),K=d(require("picocolors"));var B="vite-bundle-analyzer";var T=d(require("fs/promises")),j=d(require("path")),q=d(require("fast-glob"));var M=d(require("zlib")),G=d(require("util")),k=d(require("path"));function Z(e){let t=["Bytes","KB","MB","GB","TB"];if(!e)return"0 "+t[0];let r=parseInt(`${Math.floor(Math.log(e)/Math.log(1024))}`);return(e/(1<<r*10)).toFixed(2)+" "+t[r]}function y(e,t){return t.reduce((r,s)=>(r[s]=e[s],r),{})}var yt=G.default.promisify(M.default.gzip),ht={level:M.default.constants.Z_DEFAULT_LEVEL},g=b(k.default.join(__dirname,"client")),W=k.default.join(g,"assets");function D(e={}){return e=Object.assign(ht,e),t=>yt(t,e)}function b(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}function z(e){let t=e.injectTo==="head"?/([ \t]*)<\/head>/i:/([ \t]*)<\/body>/i;return e.html.replace(t,r=>`${e.descriptors.join(` `)}${r}`)}async function J(e,t){let r=q.default.sync(b(j.default.join(W,"*"))),n=(await Promise.all(r.map(async a=>{let l=j.default.extname(a).replace(".",""),o=await T.default.readFile(a,"utf8");return{fileType:l,content:o}}))).filter(a=>["js","css"].includes(a.fileType)),i=await T.default.readFile(j.default.join(g,"index.html"),"utf8");return i=i.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,""),i=i.replace(/<link\b[^>]*rel="stylesheet"[^>]*>/gi,""),i=i.replace(/<title>(.*?)<\/title>/,`<title>${t.title}</title>`),i=z({html:i,injectTo:"head",descriptors:n.map(({fileType:a,content:l})=>a==="js"?`<script>${l}</script>`:`<style>${l}</style>`)}),i=z({html:i,injectTo:"body",descriptors:[`<script> window.defaultSizes = ${JSON.stringify(t.mode)}; window.foamModule = ${JSON.stringify(e)}; </script>`]}),i}var F=d(require("path")),E=require("source-map");var gt=b(process.cwd());function bt(e){return e=b(e),e.replace(gt,"").replace(/\0/,"")}function zt(e){let t=e.split("/");if(t.length===1)return t;let r=[],s=t.pop();for(;t.length;){let n=t.shift();r.push(n)}return[r,s]}function A(e){let t=bt(e);return F.default.isAbsolute(t)?t.replace("/",""):t}async function St(e,t){let r={};return t?(await E.SourceMapConsumer.with(t,null,s=>{let n=1,i=0;for(let a=0;a<e.length;a++,i++){let{source:l}=s.originalPositionFor({line:n,column:i});if(l){let o=l.replace(/\.\.\//g,"");o in r?r[o]+=e[a]:r[o]=e[a]}e[a]===` `&&(n+=1,i=-1)}}),r):{}}var S=class{id;label;path;pairs;pairIds;groups;constructor(t){this.id=t,this.label=t,this.path=t,this.pairs=Object.create(null),this.groups=[],this.pairIds=[]}addPairsNode(t,r){this.pairs[t]||(r.label=t,r.path=t,this.pairs[t]=r,this.pairIds.push(t))}addPairs(t){return this.pairs[t.id]=t,this.pairIds.push(t.id),t}getChild(t){return this.pairs[t]}},x=class extends S{parsedSize;gzipSize;constructor(t,r,s){super(t),this.parsedSize=r,this.gzipSize=s}};function P(e,t,r){return new x(A(e),t,r)}var N=class extends S{statSize;constructor(t,r){super(t),this.statSize=r}};function V(e,t){return new N(A(e),t)}var C=class extends S{parsedSize;mapSize;statSize;gzipSize;source;stats;pairs;imports;isAsset;isEntry;currentNodeKind;constructor(t){super(t),this.parsedSize=0,this.statSize=0,this.gzipSize=0,this.mapSize=0,this.source=[],this.stats=[],this.pairs=Object.create(null),this.imports=new Set,this.isAsset=!0,this.isEntry=!1,this.currentNodeKind="stat"}processTreeNode(t,r){let s=zt(t.id);if(s.length===1){this.addPairsNode(t.id,t);return}let[n,i]=s,a=this;n.forEach(l=>{let o=a.getChild(l);o||(o=a.addPairs(r==="stat"?V(l,0):P(l,0,0))),a=o}),i&&a.addPairsNode(i,t)}addImports(...t){t.forEach(r=>this.imports.add(r))}async setup(t,r,s){let n=t.modules,i=Buffer.from(t.code,"utf8"),a=await s(i);this.gzipSize=a.byteLength,this.parsedSize=i.byteLength,t.map&&(this.mapSize=Buffer.from(t.map.toString()).byteLength);let l=await St(t.code,t.map);for(let u in n){let c=r.getModuleInfo(u);if(!c)continue;let{id:m}=c;if(/\.(mjs|js|ts|vue|jsx|tsx|svelte)(\?.*|)$/.test(m)||m.startsWith("\0")){let f=V(m,n[u].renderedLength);this.statSize+=f.statSize,this.stats.push(f)}}let o=t.moduleIds.filter(u=>u.startsWith("\0")),p={parsedSize:0};for(let u in l){if(!t.moduleIds.length)continue;let c=t.moduleIds.find(m=>m.match(u));if(c){let m=Buffer.from(l[u],"utf8"),f=await s(m);p.parsedSize+=m.byteLength,this.source.push(P(c,m.byteLength,f.byteLength))}}if(o.length>0){let{code:u,map:c}=t,m=c?.sources?.[0];if(m){let f=null;await E.SourceMapConsumer.with(t.map,null,nt=>{let _=1,w=0;for(let O=0;O<u.length;O++,w++){let{source:ot}=nt.originalPositionFor({line:_,column:w});if(ot===m){f=Buffer.from(u.substring(0,w),"utf8");break}u[O]===` `&&(_+=1,w=-1)}});let it=f?(await s(f)).byteLength:0;this.source.push(P("\0virtual-chunks",this.parsedSize-p.parsedSize,it))}}this.source.length||this.source.push(P(this.id,this.parsedSize,this.gzipSize)),this.currentNodeKind="stat",this.stats=this.prepareNestedNodes(this.stats,this.currentNodeKind),this.currentNodeKind="source",this.source=this.prepareNestedNodes(this.source,this.currentNodeKind),this.isEntry=t.isEntry}prepareNestedNodes(t,r){for(;t.length;){let s=t.shift();if(!s)break;this.processTreeNode(s,r)}return this.walk(this,(s,n)=>{n.groups.push(s)}),this.mergeFolder()}walk(t,r){t.pairIds.length&&(t.pairIds.forEach(s=>{if(s in t.pairs){let n=t.pairs[s];r(n,t),this.walk(n,r)}}),t.pairIds=[],t.pairs={})}mergeFolder(){let t=s=>{if(!s.groups.length){if(s instanceof N)return y(s,["id","path","label","statSize"]);if(s instanceof x)return y(s,["id","path","label","parsedSize","gzipSize"])}let n=s.groups.map(t);if(n.length===1&&!F.default.extname(s.id)){let i={},a=n[0];if(i.id=s.id,i.label=`${s.label}/${a.label}`,i.path=`${s.path}/${a.path}`,s instanceof N)return Object.assign(i,y(a,["statSize","groups"])),i;if(s instanceof x)return Object.assign(i,y(a,["parsedSize","gzipSize","groups"])),i}if(this.currentNodeKind==="stat"){let{statSize:i}=n.reduce((a,l)=>(a.statSize+=l.statSize,a),{statSize:0});return{...y(s,["id","path","label"]),statSize:i,groups:n}}if(this.currentNodeKind==="source"){let{parsedSize:i,gzipSize:a}=n.reduce((l,o)=>(l.parsedSize+=o.parsedSize,l.gzipSize+=o.gzipSize,l),{parsedSize:0,gzipSize:0});return{...y(s,["id","path","label"]),parsedSize:i,gzipSize:a,groups:n}}},r=this.groups.map(s=>t(s));return this.groups=[],r}};function xt(e){return new C(A(e))}var I=class{compress;modules;pluginContext;constructor(t){this.compress=D(t),this.modules=[],this.pluginContext=null}installPluginContext(t){this.pluginContext||(this.pluginContext=t)}async addModule(t,r){let s=xt(t);s.addImports(...r.imports,...r.dynamicImports),await s.setup(r,this.pluginContext,this.compress),this.modules.push(s)}processFoamModule(){let r=(s=>{let n=(i,a=[])=>{let l=[...i.imports].flatMap(p=>this.modules.filter(u=>!a.includes(u.id)&&u.id===A(p))),o=l.map(p=>p.id).concat(a);return l.flatMap(p=>n(p,o)).concat(l)};return s.filter(i=>i.isEntry).reduce((i,a)=>(n(a).forEach(l=>{i[l.id]||(i[l.id]=new Set),i[l.id].add(a.id)}),i),{})})(this.modules);return this.modules.map(s=>({...y(s,["id","label","path","statSize","parsedSize","mapSize","gzipSize","source","stats","isAsset","isEntry"]),imports:Array.from(r[s.id]??[])}))}};function U(e){return new I(e)}var Q=d(require("http")),X=d(require("fs")),Y=d(require("path")),tt=d(require("sirv"));var Nt=(0,tt.default)(g,{dotfiles:!0});function et(e=0){let t=Q.default.createServer();return t.on("request",(s,n)=>{Nt(s,n,()=>{n.statusCode=404,n.end("File not found")})}),t.listen(e,()=>{console.log(`server run on http://localhost:${t.address().port}`)}),{setup:(s,n)=>{t.on("listening",()=>{let i=t.listeners("request");t.removeAllListeners("request"),t.on("request",(a,l)=>{if(a.url==="/"){l.setHeader("Content-Type","text/html; charset=utf8;");let o=X.default.readFileSync(Y.default.join(g,"index.html"),"utf8");o=o.replace(/<title>(.*?)<\/title>/,`<title>${n.title}</title>`),o=z({html:o,injectTo:"body",descriptors:[`<script> window.defaultSizes = ${JSON.stringify(n.mode)}; window.foamModule = ${JSON.stringify(s)}; </script>`]}),l.end(o)}else i.map(o=>o.call(t,a,l))})})},get port(){return t.address().port}}}var wt=!!process.env.CI;async function vt(e){await import("open").then(t=>t.default(e,{newInstance:!0})).catch(()=>{})}var st=e=>K.default.dim(K.default.bold(e)),$=e=>st(Z(e)),rt=e=>{let t=e.length,r=e.reduce((n,i)=>(n.gzip+=i.gzipSize,n.parsed+=i.parsedSize,n.map+=i.mapSize,n),{gzip:0,parsed:0,map:0}),s=[r.gzip&&`gzip: ${$(r.gzip)}`,r.map&&`map: ${$(r.map)}`].filter(Boolean).join(" | ");return`${st(t)} chunks of ${$(r.parsed)} ${s?`(${s})`:""}`};function jt(e={analyzerMode:"server",summary:!0}){let{reportTitle:t=B}=e,r=U(e?.gzipOptions),s=process.cwd(),n=!1,i=!0,a;return{name:B,apply:"build",enforce:"post",configResolved(o){if(s=o.build.outDir??o.root,a=o.logger,e.summary){let p=o.plugins.find(u=>u.name==="vite:reporter");if(i=!!p?.writeBundle,p?.writeBundle){let u=typeof p.writeBundle=="function"?p.writeBundle:p.writeBundle?.handler,c=async function(...m){await u?.apply(this,m),a.info(rt(r.modules))};typeof p.writeBundle!="function"?p.writeBundle.handler=c:p.writeBundle=c}}},config(o){o.build?.sourcemap&&(n=typeof o.build.sourcemap=="boolean"?o.build.sourcemap:o.build.sourcemap==="hidden"),o.build||(o.build={}),o.build.sourcemap="hidden"},async generateBundle(o,p){r.installPluginContext(this);for(let u in p){let c=p[u];c.type==="chunk"&&(await r.addModule(u,c),!n&&c.sourcemapFileName&&Reflect.deleteProperty(p,c.sourcemapFileName))}},async closeBundle(){switch(e.summary&&!i&&a.info(rt(r.modules)),e.analyzerMode){case"json":{let o=L.default.join(s,e.fileName?`${e.fileName}.json`:"stats.json"),p=r.processFoamModule();R.default.writeFile(o,JSON.stringify(p,null,2),"utf8");break}case"static":{let o=L.default.join(s,e.fileName?`${e.fileName}.html`:"stats.html"),p=r.processFoamModule(),u=await J(p,{title:t,mode:"stat"});R.default.writeFile(o,u,"utf8");break}case"server":{let o=r.processFoamModule(),{setup:p,port:u}=et((e.analyzerPort==="atuo"?0:e.analyzerPort)??8888);if(p(o,{title:t,mode:"stat"}),(e.openAnalyzer??!0)&&!wt){let c=`http://localhost:${u}`;await vt(c)}break}default:throw new Error("Invalidate Option `analyzerMode`")}}}}0&&(module.exports={analyzer});
